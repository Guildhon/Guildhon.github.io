My Note
-------- 
> 网络基础

### ISO/OSI七层模型
ISO:国际标准化组织 

OSI:开放系统互连模型 

IOS:在计算机网络中，IOS是互联网操作系统，是思科公司为其网络设备开发的操作系统

MAC地址负责局域网通信，IP地址负责外网通信，端口号确定服务进程

```
应用层，用户接口
表示层，数据的表现形式，特定功能的实现，如加密
会话层，对应用会话的管理，同步
传输层，可靠与不可靠的传输，传输前的错误检测，流控
网络层，提供逻辑地址，选路
数据链路层，成帧，用MAC地址访问媒介，错误检测与修正
物理层，设备之间的比特流的传输，物理接口，电气特性等
```

### TCP/IP四层模型
```
应用层3
传输层1
网际互联层1
网络接口层2
```
#### 网络接口层
与OSI参考模型中物理层和数据链路层相对应。它负责监视数据在主机和网络之间的交换。实际上，TCP/IP本身并未定义改层的协议，而由参与互连的各网络使用自己的物理层和链路层协议，然后与TPC/IP的网络接入层进行连接。地址解析协议（ARP）工作在此层，即OSI参考模型的数据链路层。

#### 网际互联层
对应OSI参考模型网络层，主要解决主机到主机的通信问题。它所包含的协议设计数据包在整个网络上的逻辑传输。该层有三个主要协议：网际协议（IP）、互联网组管理协议（IGMP）和互联网控制报文协议（ICMP）

#### 传输层
对应于传输层，为应用层实体提供端到端的通信功能，保证了数据包的顺序传送及数据的完整性。该层定义了两个主要的协议：传输控制协议（TCP）和用户数据报协议（UDP）

#### 应用层
应用层对应于OSI参考模型的高层，为用户提供所需的各种服务，例如：FTP，Telnet，DNS，SMTP等

### IP地址
![img](https://img.mukewang.com/5d73a2f90001927f12800720.jpg)

IP地址与子网掩码与运算得到网络地址

### 端口
```
FTP（文件传输协议） 端口号20 21
SSH（安全shell协议） 端口号22
telnet（远程登录协议） 端口号23
DNS （域名系统）端口号53
http （超文本传输协议） 端口号80
SMTP （简单邮件传输协议）端口25
POT3 （邮局协议3代）端口号110
```

#### netstat 查看本机启用的端口
netstat -an 
- -a 查看所有连接和监听端口
- -n 显示IP地址和端口号，而不显示域名和服务名


### DNS作用
hosts是做静态IP和域名对应，优先级是高于DNS解析的

早期hosts文件解析域名
- 名称解析效能下降	
- 主机维护困难

DNS服务
- 层次性
- 分布式

将域名解析为IP地址
- 客户机向DNS服务器发送域名查询请求
- DNS服务器告知客户机Web服务器的IP地址
- 客户机与Web服务器通信

.点表示根域名 跟域名的服务器只有13台
- 根域
- 顶级域 com
- 二级域 imooc 
- 主机名 www NEWS

DNS查询，本地域名服务器查询不到，从根DNS服务器开始，分配到其他顶级域名com/cn等继续查找

查询方式上分递归查询和迭代查询，查找内容上分，正向查询由域名查找IP地址，反向查询由IP地址查找域名

### 网关作用
1. 网关（Gateway）又称网间连接器，协议转换器

2. 网关在网络层以上实现网络互连，是最复杂的网络互连设备，仅用于两个高层协议不同的网络互连

3. 网关既可以用于广域网互连，也可以用于局域网互连	 

4. 网关是一种充当转换重任的服务器或路由器

- 网关在所有内网计算机访问的不是本网段的数据报时使用
- 网关负责将内网IP转换为公网IP，公网IP转换为内网IP

### Linux配置IP
局域网络中，有人搭建DHCP服务器，可以选择自动获取IP，DNS

#### ifconfig命令
查看与临时配置网络状态命令
```
ifconfig eht0 192.168.0.200 netmask 255.255.255.0  # 临时设置eth0网卡的IP地址与子网掩码
```

#### 工具
centos7已经不再使用setup工具来修改网络配置，而是使用nmtui，首先yum install NetworkManager-tui。然后输入nmtui
```
service network restart 
```

#### 文件配置
网卡信息文件
```
[root@VM_0_2_centos ~]# cat /etc/sysconfig/network-scripts/ifcfg-eth0
DEVICE=eth0    					网卡设备名
BOOTPROTO=dhcp					是否自动获取IP（none,static,dhcp）
HWADDR=52:54:00:b7:8d:71        MAC地址
NM_CONTROLLED=no                是否可以由Network Manager图形管理工具托管
ONBOOT=yes						是否随网络服务启动，eht0生效
TYPE=Ethernet					类型为以太网
UUID="xxx"               		唯一标识码
IPADDR=		                    IP地址
NETMASK=						子网掩码
GATEWAY=						网关
DNS1=							DNS
IPV6INIT=no						IPv6没有启动
USERCTL=no                      不允许非root用户控制此网卡
PERSISTENT_DHCLIENT=yes
```

#### 主机名文件
修改主机名，都需要重启生效
```
hostnamectl set-hostname 主机名
```
ubuntu主机名配置文件：/etc/hostname

ubuntu的网络配置文件位置/etc/network/interfaces

使用hostname xxx临时生效，重启失效，但配置文件的生效

#### DNS配置文件
```
[root@VM_0_2_centos ~]# cat /etc/resolv.conf 
; generated by /usr/sbin/dhclient-script
nameserver 183.60.83.19         # 名称服务器，dns服务器
nameserver 183.60.82.98
```

#### 虚拟机
网络连接模式
桥接，能跟局域网机器通信，用真实网卡通信，NAT能跟公网通信

### 网络命令
windows ipconfig  /all

#### 关闭与启动网卡
```
ifconfig  查看网卡
ifdown 网卡设备名 # 禁用该网卡设备
ifup   网卡设备名 # 启用该网卡设备
```

### 查询网络状态
#### netstat
- -t 列出TCP协议端口
- -u 列出UDP协议端口
- -n 不适用域名与服务名，而使用IP地址和端口号，显示更快，不用翻译域名
- -l 仅列出在监听状态网络服务
- -a 列出所有的网络连接
- -r 列出路由列表，功能和routes命令一致，可以看到网关

#### routes
routes -n = netstat -rn
```
routes add default gw 192.168.1.1 # 临时设置网关
```

#### nslookup
用来翻译域名对应那个IP
```
nslookup 域名

nslookup
> server  # 查看本机DNS机器
> quit
```

### 网络测试
#### ping ip或者域名  
探测指定IP或域名的网络状况
- -c 次数 指定ping包的次数

#### telnet [域名或IP] [端口]
远程登录与端口探测命令
```
yum list telnet*              列出telnet相关的安装包
yum install telnet-server          安装telnet服务
yum install telnet.*           安装telnet客户端
```

#### traceroute [选项] IP或域名
路由跟踪命令
- -n 使用IP，不使用域名，速度更快

#### wget
下载命令

#### tcpdump
tcpdump -i eht0 -nnX port 21
- -i 指定网卡接口
- -nn 将数据包中的域名与服务转化为IP和端口
- -X 以十六进制和ASCII码显示数据报内容
- port 监听端口

### SSH
``` 
ssh 用户名@ip  # 远程登录指定的Linux服务器
scp [-r] 用户名@ip:文件路径 本地路径   # 下载文件
scp [-r] 本地文件 用户名@ip:上传路径   #上传文件 
```

